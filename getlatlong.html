<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>
        Weather Kolkata | Home
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="http://weatherkolkata.in/style.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .auto-style1 {
            width: auto;
            background-color: aqua;
        }

        .auto-style9 {
            width: 239px;
            height: 26px;
            text-align: center;
        }

        .auto-style10 {
            width: 240px;
            text-align: center;
            background-color: beige;
        }
    </style>
</head>

<body>
    <form method="post" action="./default.aspx" id="form1">
        <div class="aspNetHidden">
            <input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />
            <input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />
            <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKLTYyMTI0ODQyMGRkLdeJs/MU/BokUacJUB4usroG0xD8VEfmmNTo9yJthiA=" />
        </div>

        <div class="aspNetHidden">
            <input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334" />
            <input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEdAAK2vSe2ImLuDTrZGIbjQB7Z2ahO59ybsV7UQ7hoHg6JbMsdfxPUW1rZn7kbmwH1vTSCrAwGYPhjwJKPExtrNXRR" />
        </div>
        <div class="container">
            <div class="header">
                <!-- end .header -->
                <img src="images/banner.jpg" style="width: inherit; height: auto; max-height: 200px;" />
            </div>
            <ul id="dhtmlmenu1" style="list-style: none; margin: 0; padding: 0">
                <li style="display: inline">
                    <!-- source: "D:/jobs/IIT/civil/Rain GPRS/website/weather/weather.dms" -->
                    <img id="TrackPath_m1" src="http://weatherkolkata.in/menu-files/empty.gif" width="1" height="1" style="display: none" alt="" />
                    <script type="text/javascript" src="http://weatherkolkata.in/menu-files/dhtmlmenu_m1_scr.js"></script>
                    <div id="Panel1" class="container" style="height:100%;overflow:auto;">


                        <div id='xtrmenutable'>
                            <table id="m1mainSXMenu2" style="width: 100%;">
                                <tr style="text-align: center;">
                                    <td onmouseover="chgBg(m1,'m1tlm0',3);exM(m1,'none','',event)" onmouseout="chgBg(m1,'m1tlm0',0,1)" id="m1tlm0" onmousedown="f58('m1tlm0a')" style="width: 50px; background-color: #0000FF; padding: 5px 5px 5px 5px" class="m1mit"><a id="m1tlm0a" class="m1CL0" href="default.aspx">Home</a></td>

                                    <td onmouseover="chgBg(m1,'m1tlm2',3);exM(m1,'m1mn1','m1tlm2',event)" onmouseout="chgBg(m1,'m1tlm2',0);coM(m1,'m1mn1')" id="m1tlm2" style="width: 50px; background-color: #0000FF; padding: 5px 5px 5px 5px" class="m1mit"><a id="m1tlm2a" class="m1CL0" href="javascript:void(0);">Weather<img width="8" height="8" src="menu-files/dhtmlmenu_m1iad.gif" style="vertical-align: middle; border-style: none" alt="" /></a></td>
                                    <td onmouseover="chgBg(m1,'m1tlm3',3);exM(m1,'m1mn2','m1tlm3',event)" onmouseout="chgBg(m1,'m1tlm3',0);coM(m1,'m1mn2')" id="m1tlm3" style="width: 50px; background-color: #0000FF; padding: 5px 5px 5px 5px" class="m1mit"><a id="m1tlm3a" class="m1CL0" href="javascript:void(0);">Water Level<img width="8" height="8" src="menu-files/dhtmlmenu_m1iad.gif" style="vertical-align: middle; border-style: none" alt="" /></a></td>
                                    <td onmouseover="chgBg(m1,'m1tlm4',3);exM(m1,'none','',event)" onmouseout="chgBg(m1,'m1tlm4',0,1)" id="m1tlm4" onmousedown="f58('m1tlm4a')" style="width: 50px; background-color: #0000FF; padding: 5px 5px 5px 5px" class="m1mit"><a id="m1tlm4a" class="m1CL0" href="Admin/Disable.aspx">Admin</a></td>
                                    <td onmouseover="chgBg(m1,'m1tlm5',3);exM(m1,'none','',event)" onmouseout="chgBg(m1,'m1tlm5',0,1)" id="m1tlm5" onmousedown="f58('m1tlm5a')" style="width: 50px; background-color: #0000FF; padding: 5px 5px 5px 5px" class="m1mit"><a id="m1tlm5a" class="m1CL0" href="AboutProject.aspx">About Project</a></td>
                                    <td onmouseover="chgBg(m1,'m1tlm6',3);exM(m1,'none','',event)" onmouseout="chgBg(m1,'m1tlm6',0,1)" id="m1tlm6" onmousedown="f58('m1tlm6a')" style="width: 50px; background-color: #0000FF; padding: 5px 5px 5px 5px" class="m1mit"><a id="m1tlm6a" class="m1CL0" href="ContactUs.aspx">Contact Us</a></td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </li>
            </ul>

            <h1> Welcome To The Home of Weather Kolkata</h1>

            <div id="ContentPlaceHolder1_pnlClick" class="pnlCSS">

                <div style="background-image:url('images/blue.jpg'); height:30px; vertical-align:middle">
                    <div style="float:left; color:White;padding:5px 5px 0 0">
                        Graphical History
                    </div>
                    <div style="float:right; color:White; padding:5px 5px 0 0">
                        <span id="ContentPlaceHolder1_lblMessage">Label</span>
                        <img id="ContentPlaceHolder1_imgArrows" src="" />
                    </div>
                    <div style="clear:both"></div>
                </div>

            </div>

            <div id="ContentPlaceHolder1_pnlCollapsable" class="pnlCSS" style="height:0px;">

                <div id="chart1" class="auto-style1" style="display:flex"></div>
                <div id="chart2" class="auto-style1" style="display:flex"></div>

            </div>

            <input type="hidden" name="ctl00$ContentPlaceHolder1$CollapsiblePanelExtender1_ClientState" id="ContentPlaceHolder1_CollapsiblePanelExtender1_ClientState" />

            <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAQXnzEJ7fKG0gMWYq1xTGNoz7y1ikHtvo"></script>
            <script type="text/javascript" src="http://weatherkolkata.in/Scripts/jquery-2.2.3.min.js"></script>
            <script type="text/javascript" src="http://weatherkolkata.in/Scripts/jsapi.js"></script>
            <script type="text/javascript">
    google.load('visualization', '1', { packages: ['corechart'] });
            </script>


            <div id="map" style="width:auto; height:700px; display:block;" title="Weather Kolkata"></div>

            <script type="text/javascript">
      var res;


      var locations = [
        ['IIEST-Shibpur', 22.5551846, 88.3073548],
        ['New Market', 22.5619176, 88.3529215],
        ['IMD Dumdum', 22.6418670, 88.4333043],
        ['Ultadanga', 22.5886807, 88.3967528],
        ['IMD Alipore', 22.5356495, 88.3310035],
        ['Patuli', 22.4739897, 88.3931865],
        ['Joka', 22.4527284, 88.3026874],
      ];
      var locations2 = [
          ['Kamdahari', 22.4634200, 88.3779841],
          ['Behala Flying Club', 22.5089641, 88.2995197],
          ['CPT Canal', 22.5098704, 88.3210109],
      ];
      var locations3 = [
          ['Dhapa', 22.5578443, 88.4108495,6,1.83],
          ['Palmer Bridge', 22.5631409, 88.3778603,11,3.35],
          ['Ballygaunge', 22.5361669, 88.3746742,7.5,2.28],
          ['EE-1 Minor', 22.5244252, 88.3968457,9.8,3],
      ];

      var wIcon = 'icon/flood.png';
      var rIcon = 'icon/cloudysunny.png';
      var cIcon = 'icon/flood_green.png';
      var lIcon = 'icon/flood_road.png';
      var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: new google.maps.LatLng(22.5578443, 88.4108495),
          mapTypeId: google.maps.MapTypeId.ROADMAP
      });

      var infowindow = new google.maps.InfoWindow();
      var marker, i;
      var nodeList;
      //for (i = 0; i < locations.length; i++) {
      //    marker = new google.maps.Marker({
      //        title: locations[i][0],
      //        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
      //        animation: google.maps.Animation.DROP,
      //        icon: rIcon,
      //        map: map
      //    });

      //    google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
      //        return function () {
      //            //xhttp = new XMLHttpRequest();
      //            //xhttp.onreadystatechange = function (marker) {
      //            //    if (xhttp.readyState == 4 && xhttp.status == 200) {
      //            //        infowindow.setContent(marker.getTitle() + xhttp.responseText);
      //            //        infowindow.open(map, marker);
      //            //    }
      //            //}(marker);
      //            //xhttp.open("GET", "default.aspx/GetData", true);
      //            //xhttp.send();
      //            //map.setCenter(marker.getPosition());
      //            //map.setZoom(12);
      //            $.ajax({
      //                url: "Default.aspx/GetWeatherData",
      //                data: "{'nodename':'"+marker.getTitle()+"'}",
      //                dataType: "json",
      //                type: "POST",
      //                contentType: "application/json; charset=utf-8",

      //                success: function (result) {
      //                    infowindow.setContent('<div id="ih_weather">'+marker.getTitle()+'</div>'+result.d);
      //                    infowindow.open(map, marker);
      //                }
      //            });
      //        }
      //    })(marker, i));
      //    google.maps.event.addListener(marker, 'click', (function (marker) {
      //        return function () {
      //            drawRainGraph(marker);
      //        }
      //    })(marker));
      //}
      //for (i = 0; i < locations2.length; i++) {
      //    marker = new google.maps.Marker({
      //        title: locations2[i][0],
      //        position: new google.maps.LatLng(locations2[i][1], locations2[i][2]),
      //        animation: google.maps.Animation.DROP,
      //        icon: wIcon,
      //        map: map
      //    });

      //    google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
      //        return function () {
      //            $.ajax({
      //                url: "Default.aspx/GetLevelData",
      //                data: "{'nodename':'" + marker.getTitle() + "'}",
      //                dataType: "json",
      //                type: "POST",
      //                contentType: "application/json; charset=utf-8",

      //                success: function (result) {
      //                    /*infowindow.setContent('<h1>'+marker.getTitle()+'</h1>'+ result.d);*/
      //                    infowindow.setContent('<div id="ih_water">'+marker.getTitle()+'</div>'+ result.d);
      //                    infowindow.open(map, marker);
      //                }
      //            });
      //        }
      //    })(marker, i));
      //    google.maps.event.addListener(marker, 'click', (function (marker) {
      //        return function () {
      //            drawLevelGraph(marker);
      //        }
      //    })(marker));
      //}

      //for (i = 0; i < locations3.length; i++) {
      //    marker = new google.maps.Marker({
      //        title: locations3[i][0],
      //        position: new google.maps.LatLng(locations3[i][1], locations3[i][2]),
      //        animation: google.maps.Animation.DROP,
      //        icon: cIcon,
      //        map: map
      //    });

      //    google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
      //        return function () {
      //            $.ajax({
      //                url: "Default.aspx/GetWeatherLevelData",
      //                data: "{'nodename':'" + marker.getTitle() + "'}",
      //                dataType: "json",
      //                type: "POST",
      //                contentType: "application/json; charset=utf-8",

      //                success: function (result) {
      //                    /*infowindow.setContent('<h1>'+marker.getTitle()+'</h1>'+ result.d);*/
      //                    infowindow.setContent('<div id="ih_water">' + marker.getTitle() + '</div>' + result.d);
      //                    infowindow.open(map, marker);
      //                }
      //            });
      //        }
      //    })(marker, i));
      //    google.maps.event.addListener(marker, 'click', (function (marker) {
      //        return function () {
      //            drawLevelGraph(marker);
      //            drawRainGraph(marker);
      //        }
      //    })(marker));
      //}

      $.ajax({
          url: "http://weatherkolkata.in/default.aspx?GetNodeList",
          //data: "{''}",
          //dataType: "json",
          type: "POST",
          contentType: "application/json",
          success: function (result) {
              nodeList = result.d;
              for (i = 0; i < nodeList.length; i++) {
                  if (nodeList[i].Type == "wr") {
                      console.log([nodeList[i].Name, nodeList[i].Lat, nodeList[i].Lng]);
                      marker = new google.maps.Marker({
                          title: nodeList[i].Name,
                          position: new google.maps.LatLng(nodeList[i].Lat, nodeList[i].Lng),
                          animation: google.maps.Animation.DROP,
                          icon: cIcon,
                          map: map
                      });

                      google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
                          return function () {
                              $.ajax({
                                  url: "Default.aspx/GetWeatherLevelData",
                                  data: "{'nodename':'" + marker.getTitle() + "'}",
                                  dataType: "json",
                                  type: "POST",
                                  contentType: "application/json",

                                  success: function (result) {
                                      /*infowindow.setContent('<h1>'+marker.getTitle()+'</h1>'+ result.d);*/
                                      infowindow.setContent('<div id="ih_water">' + marker.getTitle() + '</div>' + result.d);
                                      infowindow.open(map, marker);
                                  }
                              });
                          }
                      })(marker, i));
                      google.maps.event.addListener(marker, 'click', (function (marker) {
                          return function () {
                              drawLevelGraph(marker);
                              drawRainGraph(marker);
                          }
                      })(marker));
                  }
                  else if (nodeList[i].Type == "w") {
                      marker = new google.maps.Marker({
                          title: nodeList[i].Name,
                          position: new google.maps.LatLng(nodeList[i].Lat, nodeList[i].Lng),
                          animation: google.maps.Animation.DROP,
                          icon: wIcon,
                          map: map
                      });

                      google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
                          return function () {
                              $.ajax({
                                  url: "Default.aspx/GetLevelData",
                                  data: "{'nodename':'" + marker.getTitle() + "'}",
                                  dataType: "json",
                                  type: "POST",
                                  contentType: "application/json",

                                  success: function (result) {
                                      /*infowindow.setContent('<h1>'+marker.getTitle()+'</h1>'+ result.d);*/
                                      infowindow.setContent('<div id="ih_water">' + marker.getTitle() + '</div>' + result.d);
                                      infowindow.open(map, marker);
                                  }
                              });
                          }
                      })(marker, i));
                      google.maps.event.addListener(marker, 'click', (function (marker) {
                          return function () {
                              drawLevelGraph(marker);
                          }
                      })(marker));
                  }
                  else if (nodeList[i].Type == "r") {
                      marker = new google.maps.Marker({
                          title: nodeList[i].Name,
                          position: new google.maps.LatLng(nodeList[i].Lat, nodeList[i].Lng),
                          animation: google.maps.Animation.DROP,
                          icon: rIcon,
                          map: map
                      });

                      google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
                          return function () {
                              $.ajax({
                                  url: "Default.aspx/GetWeatherData",
                                  data: "{'nodename':'" + marker.getTitle() + "'}",
                                  dataType: "json",
                                  type: "POST",
                                  contentType: "application/json",

                                  success: function (result) {
                                      infowindow.setContent('<div id="ih_weather">' + marker.getTitle() + '</div>' + result.d);
                                      infowindow.open(map, marker);
                                  }
                              });
                          }
                      })(marker, i));
                      google.maps.event.addListener(marker, 'click', (function (marker) {
                          return function () {
                              drawRainGraph(marker);
                          }
                      })(marker));
                  }
                  else if (nodeList[i].Type == "l") {
                      marker = new google.maps.Marker({
                          title: nodeList[i].Name,
                          position: new google.maps.LatLng(nodeList[i].Lat, nodeList[i].Lng),
                          animation: google.maps.Animation.DROP,
                          icon: lIcon,
                          map: map
                      });

                      google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
                          return function () {
                              $.ajax({
                                  url: "Default.aspx/getLoggingData",
                                  data: "{'nodename':'" + marker.getTitle() + "'}",
                                  dataType: "json",
                                  type: "POST",
                                  contentType: "application/json",

                                  success: function (result) {
                                      /*infowindow.setContent('<h1>'+marker.getTitle()+'</h1>'+ result.d);*/
                                      infowindow.setContent('<div id="ih_weather">' + marker.getTitle() + '</div>' + result.d);
                                      infowindow.open(map, marker);
                                  }
                              });
                          }
                      })(marker, i));
                  }

              }
          }
      });


      function drawLevelGraph(mrkr) {
            //var list = document.getElementById("");
            //var selectedNode = list.options[list.selectedIndex].text;
          //var selectedDate = document.getElementById("").value;
          $find("cpe1").expandPanel();
            $.ajax({
                url: "default.aspx/GetLevelGraphData",
                type: "POST",
                dataType: "JSON",
                data: "{'nodeName' : '"+mrkr.getTitle()+"'}",
                contentType: "application/json",

                success:
                    function(response) {
                        drawLevelVisualization(response.d, mrkr);
                    }

            });
      }

      function drawRainGraph(mrkr) {
            //var list = document.getElementById("");
            //var selectedNode = list.options[list.selectedIndex].text;
          //var selectedDate = document.getElementById("").value;
          $find("cpe1").expandPanel();
            $.ajax({
                url: "default.aspx/GetRainGraphData",
                type: "POST",
                dataType: "JSON",
                data: "{'nodeName' : '"+mrkr.getTitle()+"'}",
                contentType: "application/json",

                success:
                    function(response) {
                        plotRainGraph(response.d, mrkr);
                    }

            });
        }

        function drawLevelVisualization(dataValues, mrkr) {
            var data = new google.visualization.DataTable();


            data.addColumn('timeofday', 'Time');
            data.addColumn('number', 'Water Level');
            data.addColumn('number', 'Min Level');
            //for (var i = 0, h = 0, m = 0; i < 96; i++, m += 15) {
            //    if ((i % 4) == 0 && (i / 4) > 0)
            //        h++;
            //    if (i < dataValues.length)
            //        data.addRow([h.toString() + ":" + (m % 60).toString(), dataValues[i].Value]);
            //    else
            //        data.addRow([h.toString() + ":" + (m % 60).toString(), null]);
            //}
            for (var i = 0; i < dataValues.length; i++) {
                data.addRow([[dataValues[i].Time.Hours, dataValues[i].Time.Minutes, dataValues[i].Time.Seconds], dataValues[i].Value, dataValues[i].Min]);
            }
            new google.visualization.AreaChart(document.getElementById('chart1')).
                draw(data, {
                    title: "Today's Sump Level History At "+mrkr.getTitle(),
                    animation: {
                        startup: 'true',
                        duration: 1000,
                        easing: 'inAndout'
                    },
                    colors: ['#01579B', '#00E676'],
                    hAxis: {
                        title: 'Time of Day',
                        viewWindow: {
                            min: [0, 0, 0],
                            max: [23, 59, 59]
                        },
                        gridlines: {
                            count: 11,
                        }
                    },
                    vAxis: {
                        //minValue: 0,
                        title:'Water Level in feet'
                    },
                    legend:{
                        position:'bottom'
                    },
                    chartArea: {
                        left: '7%',
                        width: '90%',
                        top: '10%',
                        height: '60%'
                    },
                    backgroundColor: {
                        fill: 'beige',
                        stroke: 'black',
                        strokeWidth: 2
                    },
                    height: 220
                });

        }
      function plotRainGraph(dataValues, mrkr) {
          var data = new google.visualization.DataTable();
          data.addColumn('timeofday', 'Time');
          data.addColumn('number', 'Rainfall');
          //for (var i = 0, h = 0, m = 0; i < 96; i++, m += 15) {
          //    if ((i % 4) == 0 && (i / 4) > 0)
          //        h++;
          //    if (i < dataValues.length)
          //        data.addRow([h.toString() + ":" + (m % 60).toString(), dataValues[i].Value]);
          //    else
          //        data.addRow([h.toString() + ":" + (m % 60).toString(), null]);
          //}
          for (var i = 0; i < dataValues.length; i++) {
              data.addRow([[dataValues[i].Time.Hours, dataValues[i].Time.Minutes, dataValues[i].Time.Seconds], dataValues[i].Value]);
          }
          new google.visualization.ColumnChart(document.getElementById('chart2')).
                draw(data, {
                    title: "Today's Rainfall History At " + mrkr.getTitle(),
                    animation: {
                        startup: 'true',
                        duration: 1000,
                        easing: 'inAndout'
                    },
                    //hAxis: {
                    //    title: 'Time in Hr',
                    //    textPosition:'in'
                    //},
                    curveType: 'function',
                    hAxis: {
                        title: 'Time of Day',
                        viewWindow: {
                            min: [0, 0, 0],
                            max: [23, 59, 59]
                        },
                        gridlines: {
                            count: 11,
                        }
                    },
                    vAxis: {
                        //minValue: 0,
                        title: 'Rainfall in mm',
                        viewWindow: {
                            min: 0
                        }
                    },
                    legend:{
                        position:'none'
                    },
                    chartArea: {
                        left: '7%',
                        width: '90%',
                        top: '10%',
                        height: '64%'
                    },
                    backgroundColor:{
                        fill: 'beige',
                        stroke: 'black',
                        strokeWidth: 2
                    },
                    height: 200

                });
      }

            </script>


        </div>


        <div class="footer">
            <p>
                Technology Developed by:
                Srijon Microsystems,
                S/404 B. P. Township,
                Kolkata 700094,
                West Bengal, India
            </p>
            <p>e-mail: info@srijon.com</p>
        </div>


        <script type="text/javascript">
//<![CDATA[
Sys.Application.add_init(function() {
    $create(Sys.Extended.UI.CollapsiblePanelBehavior, {"ClientStateFieldID":"ContentPlaceHolder1_CollapsiblePanelExtender1_ClientState","collapseControlID":"ContentPlaceHolder1_pnlClick","collapsed":true,"collapsedImage":"images/downarrow.jpg","collapsedText":"Show","expandControlID":"ContentPlaceHolder1_pnlClick","expandedImage":"images/uparrow.jpg","expandedText":"Hide","id":"cpe1","imageControlID":"ContentPlaceHolder1_imgArrows","textLabelID":"ContentPlaceHolder1_lblMessage"}, null, null, $get("ContentPlaceHolder1_pnlCollapsable"));
});
//]]>
        </script>
    </form>
</body>
</html>
